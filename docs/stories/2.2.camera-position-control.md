# Story 2.2: Camera Position Control

## Status
Accepted

## Story

**As a** user,  
**I want** to control the camera position,  
**so that** I can view the scene from different perspectives.

## Acceptance Criteria

1. User can set camera position through UI input (x, y, z coordinates)
2. Camera position changes are immediately reflected in the rendered view
3. Camera position data is properly integrated with the path tracing system
4. Invalid camera positions are handled gracefully with appropriate feedback
5. Camera position state is maintained throughout the application session

## Tasks / Subtasks

- [ ] Task 1: Implement camera data structure and management (AC: 1, 5)
  - [ ] Create Camera class or structure in src/core/
  - [ ] Define camera position properties (x, y, z coordinates)
  - [ ] Add camera orientation/direction vectors (look-at, up vectors)
  - [ ] Implement camera position validation logic
  - [ ] Add camera state management in Scene Manager
- [ ] Task 2: Create UI input controls for camera position (AC: 1, 4)
  - [ ] Add camera position input fields to UI Manager
  - [ ] Implement input validation and error handling
  - [ ] Create user feedback for invalid positions
  - [ ] Add real-time input processing for camera updates
- [ ] Task 3: Integrate camera with path tracing system (AC: 2, 3)
  - [ ] Modify PathTracer to use camera position for ray generation
  - [ ] Update ray generation algorithms to start from camera position
  - [ ] Ensure camera changes trigger re-rendering
  - [ ] Optimize camera-dependent rendering calculations
- [ ] Task 4: Add camera position persistence (AC: 5)
  - [ ] Store camera position in Scene Manager state
  - [ ] Maintain camera position across render cycles
  - [ ] Initialize with default camera position
- [ ] Task 5: Unit testing for camera functionality (All ACs)
  - [ ] Test camera position validation logic
  - [ ] Test UI input handling and feedback
  - [ ] Test path tracer integration with camera position
  - [ ] Test camera state persistence

## Dev Notes

### Previous Story Context
This story builds on Story 2.1 (Path Tracing Algorithm) which established:
- PathTracer implementation in src/render/path_tracer.{cpp,h}
- Ray generation system that will need camera position as starting point
- Integration patterns with Scene Manager for scene data
- Render Engine orchestration that will need to handle camera updates

Camera position control is fundamental to the path tracing system since ray generation must start from the camera/eye position.

### Architecture Context

#### System Architecture Integration
[Source: architecture/high_level_architecture.md]
Camera control involves multiple architectural layers:
- **UI Layer**: UI Manager handles user input for camera position changes
- **Core Logic**: Scene Manager stores camera state and provides camera data to other components
- **Render Engine**: Orchestrates re-rendering when camera position changes
- **Path Tracer Module**: Uses camera position as the origin point for ray generation

#### Component Integration Points
[Source: architecture/component_breakdown.md]

**UI Manager Integration:**
- Handles camera position input from user interface
- Provides input validation and user feedback
- Triggers camera updates in Scene Manager

**Scene Manager Integration:**
- Stores camera position and orientation data
- Provides camera information API for rendering components
- Manages camera state persistence throughout application session

**Path Tracer Integration:**
- Uses camera position as ray origin for all primary rays
- Camera changes trigger new ray generation calculations
- Camera orientation affects ray direction calculations

#### Technology Stack Requirements
[Source: architecture/technology_stack.md]
- **Programming Language**: C++17 - Camera system implementation
- **Build System**: CMake - New source files automatically discovered
- **External Libraries**: SDL/GLFW - Camera input may use keyboard/mouse events

### File Locations and Structure

**Core Camera Logic:**
- **Implementation**: src/core/camera.cpp (or integrate into scene_manager.cpp)
- **Header**: include/core/camera.h or src/core/camera.h
- **Class Name**: Camera (following PascalCase convention)

**UI Integration:**
- **Modifications**: src/ui/ui_manager.{cpp,h} - add camera input controls
- **Input Handling**: src/ui/ui_input.{cpp,h} - process camera position input

**Render Integration:**
- **Modifications**: src/render/path_tracer.{cpp,h} - use camera position for ray generation
- **Render Engine**: src/render/render_engine.{cpp,h} - handle camera change triggers

**Testing:**
- **Core Tests**: tests/core/camera_test.cpp
- **UI Tests**: tests/ui/ui_manager_test.cpp (camera input sections)
- **Integration Tests**: tests/render/path_tracer_test.cpp (camera integration)

### Technical Implementation Details

**Camera Data Structure:**
- Position coordinates: x, y, z (3D space)
- Look-at direction vector: defines viewing direction
- Up vector: defines camera orientation
- Field of view: camera viewing angle (for future use)
- Validation: ensure reasonable coordinate ranges

**UI Input Requirements:**
- Input fields for x, y, z coordinates
- Real-time feedback as user types
- Validation messages for invalid inputs
- Apply/Update button or real-time updates

**Path Tracer Integration:**
- Camera position becomes ray origin for primary rays
- Camera direction affects ray direction calculations
- Efficient ray generation from camera parameters
- Re-rendering triggered on camera position changes

**State Management:**
- Camera position stored in Scene Manager
- Default camera position initialization
- Camera state persistence during application runtime

### Technical Constraints

**Performance Considerations:**
- Camera changes trigger full scene re-rendering
- Optimize ray generation calculations for camera updates
- Consider debouncing rapid camera position changes

**Validation Requirements:**
- Prevent camera positions inside objects or at infinity
- Ensure camera coordinates are within reasonable scene bounds
- Handle edge cases gracefully with user feedback

**Architecture Constraints:**
- Camera must integrate with existing Scene Manager patterns
- UI input must follow established UI Manager patterns  
- Path tracer integration must not break existing rendering pipeline
- Must maintain separation of concerns between UI, Core, and Render layers

### Testing

**Test File Locations:**
- tests/core/camera_test.cpp - Camera data structure and validation
- tests/ui/ui_manager_test.cpp - Camera input handling
- tests/render/path_tracer_test.cpp - Camera-ray generation integration

**Testing Requirements** (Following established project patterns):
- Unit tests for camera position validation
- Unit tests for UI input processing and error handling
- Integration tests for camera-PathTracer communication
- Integration tests for Scene Manager camera state management
- End-to-end tests for camera position changes affecting rendered output

**Test Scenarios:**
- Valid camera position updates
- Invalid camera position handling
- Camera position persistence across render cycles
- Ray generation accuracy with different camera positions
- UI responsiveness to camera input changes

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-13 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled during implementation*

### Debug Log References
*To be filled during implementation*

### Completion Notes List
*To be filled during implementation*

### File List
*To be filled during implementation*

## QA Results

*This section will be populated by the QA agent after implementation review*